# Monitoring
This repository contains examples for configuring monitoring of Redpanda using Prometheus and Grafana.

---
**NOTE**: This version is designed to work with the `public_metrics` endpoint that was introduced in Redpanda 22.2 and is provided by Redpanda Cloud. If you are running an older version of Redpanda please use the [legacy version](../../tree/legacy_metrics) of these dashboards.

---
## Grafana Dashboards
The [grafana-dashboards](grafana-dashboards) folder contains sample dashboards that can be imported directly into a 
Grafana or Grafana Cloud instance.

The following dashboards are provided as examples:

- [Redpanda Ops Dashboard](grafana-dashboards/Redpanda-Ops-Dashboard.json) - Provides an overview of KPIs for a Redpanda
cluster with health indicators. This is suitable for ops or SRE to monitor on a daily or continuous basis.
- [Kafka Topic Metrics](grafana-dashboards/Kafka-Topic-Metrics.json) - Provides throughput, read/write rates, and 
on-disk sizes of each/all topics.
- [Kafka Consumer Offsets](grafana-dashboards/Kafka%20Consumer%20Offsets.json) - Metrics and KPIs that provide details 
of topic consumers and how far they are lagging behind the end of the log.
- [Redpanda Dashboard](grafana-dashboards/Redpanda-Default-Dashboard.json) - The default dashboard that would be generated by 
the [`rpk generate grafana-dashboard` command](
https://docs.redpanda.com/docs/platform/reference/rpk/rpk-generate/rpk-generate-grafana-dashboard/).
_Note: This is considered deprecated in favour of the above dashboards._
- [Kafka Consumer Metrics](grafana-dashboards/Kafka-Consumer-Metrics.json) - Allows for monitoring of Java Kafka 
consumers, using the [Prometheus JMX Exporter](https://github.com/prometheus/jmx_exporter) and the
[Kafka Sample Configuration](https://github.com/prometheus/jmx_exporter/blob/master/example_configs/kafka-2_0_0.yml).

# Alerting
This repository contains examples for configuring alerting using [Prometheus](https://prometheus.io/) (via [Alert Manager](https://prometheus.io/docs/alerting/latest/alertmanager/)) or [Grafana](https://grafana.com/).

Grafana can use Alert Manager as a source of alerts, or it can manage alerts independently of Prometheus.

# Sandbox
This example contains a fully dockerized sandbox with:
* A 3-node Redpanda cluster
* Redpanda Console
* Prometheus
* Alert Manager (from Prometheus)
* [Alert Generation](../alert-generation)
* Grafana
* Mailhog
* Kafka Connect. Used here to showcase the Kafka producer/consumer dashboards
* Owl Shop. A mock e-commerce application that generates data.

## Setup
To get started it is as simple as running the docker compose file:

```commandline
$ cd demo
$ docker-compose up -d
[+] Running 9/9
 ⠿ Network demo_default       Created
 ⠿ Container grafana          Started
 ⠿ Container prometheus       Started
 ⠿ Container redpanda-1       Started
 ⠿ Container redpanda-0       Started
 ⠿ Container redpanda-2       Started
 ⠿ Container demo-owl-shop-1  Started
 ⠿ Container demo-console-1   Started
 ⠿ Container connect          Started
```

You can check the status of the Redpanda cluster using the following command:
```commandline
$ docker exec -it redpanda-0 rpk cluster status
CLUSTER
=======
redpanda.initializing

BROKERS
=======
ID    HOST        PORT
0*    redpanda-0  29092
1     redpanda-1  29093
2     redpanda-2  29094

```
Once the bootstrap is complete, you should see all three nodes running and the cluster's UUID displayed.
```commandline
$docker exec -it redpanda-0 rpk cluster status
CLUSTER
=======
redpanda.initializing

BROKERS
=======
ID    HOST        PORT
0*    redpanda-0  29092
1     redpanda-1  29093
2     redpanda-2  29094

```
You should now be able to open the following URIs in your browser for each service:
- Redpanda Console: [http://localhost:8080/](http://localhost:8080/])
- Prometheus: [http://localhost:9090](http://localhost:9090])
- Grafana: [http://localhost:3000](http://localhost:3000])
- Mailhog: [http://localhost:8025](http://localhost:8025)

Once you log into Grafana, click on the Dashboards icon on the left and select Browse. From there, you should be able to
see the imported dashboards described above.
